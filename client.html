<!DOCTYPE html>
<html>
   <head>
      <script src="/socket.io/socket.io.js"></script>
      <script src = "login.js"></script>
      <script src = 'register.js'></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script type ="text/javascript">

      var socketio = io.connect();
      socketio.on("message_to_client",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("chatlog").appendChild(document.createElement("hr"));
         document.getElementById("chatlog").appendChild(document.createTextNode(data['message']));
      });

      function sendMessage(){
         var msg = document.getElementById("message_input").value;
         socketio.emit("message_to_server", {message:msg});
      }
      
                

      </script>
   </head>
   <body>
    <p id="login_button">Login</p>

    <div class="enter_username">
        <input type='text' id='user' placeholder='Username' required />
        <button class='login_button' id='login_button_user' name='user_type' value='user'> Join Chat </button>
        
            
        </div>
    </div>  

    <div id="messaging_stuff">
      <input type="text" id="message_input"/>
      <button id = 'send_message'>send</button> <br>
      <div id="chatlog"></div>
    </div>


    <div id = 'rooms_stuff'>
        <button id = 'create_room'>Create new room</button>
        <input type="text" id="new_room_name" placeholder = 'room name'/> <br>

        <label>Room List</label><ul id = 'room_list'>
            <!-- Populate using jQuery -->
            <li class = 'room_name'>Room Name</li>
        </ul>
    </div> 
      




      <script> 
        function escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
        $('#login_button').click(function() {
            $('.login_popup .content').show();
            })
        $('#login_button_user').click(function() {
                loginAjax();
            })

        $('.room_name').click(function() {
            // Send to chat room
        })

        socketio.on("create_room",function(data) {
            //Append an HR thematic break and the escaped HTML of the new message
            document.getElementById("chatlog").appendChild(document.createElement("hr"));
            document.getElementById("chatlog").appendChild(document.createTextNode(data['message']));
        });

        function createRoom(){
            let room_name = $('#new_room_name').val();
            console.log(room_name);
            $('#room_list').append("<li class='room_name' >" + escapeHtml(room_name) + "</li>");
            socketio.emit('create', {room_name: room_name, message: 'you created a new room!'});
        }


        $("#send_message").click(function() {
            sendMessage();
        })
        $("#create_room").click(function() {
            createRoom();
        })

        $(document).ready(function() {
            //$('#rooms_stuff').hide();
            //$('#messaging_stuff').hide();
            //$('.login_popup .content').hide();
            //Implement when we have login/register working
            
        });




    </script>
   </body>
</html>